






<!doctype html>
<html
  lang="en"
  dir="ltr"
  class="scroll-smooth"
  data-default-appearance="dark"
  data-auto-appearance="true"
><head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="rgb(255,255,255)" />
  
  <title>理解事务：InnoDB的ACID &middot; 主页</title>
    <meta name="title" content="理解事务：InnoDB的ACID &middot; 主页" />
  
  
  
  
  
  <script
    type="text/javascript"
    src="/js/appearance.min.74ad8406faea02f3e186ba5126249aaeed9073629e04b05037b903396b188724.js"
    integrity="sha256-dK2EBvrqAvPhhrpRJiSaru2Qc2KeBLBQN7kDOWsYhyQ="
  ></script>
  
  
  
  
  
  
  
  
  <link
    type="text/css"
    rel="stylesheet"
    href="/css/main.bundle.min.9602fe0216290b9ff0322c1fd14e88ab9fc0a13741f4de563f67831708d72bb2.css"
    integrity="sha256-lgL&#43;AhYpC5/wMiwf0U6Iq5/AoTdB9N5WP2eDFwjXK7I="
  />
  
    
    
    
  
  
  
    
    
  
  
    
    
  
  
  
    
    <script
      defer
      type="text/javascript"
      id="script-bundle"
      src="/js/main.bundle.min.bb487ad6073790cb02c354ee8c5f8822c42c5513e10bf7a86bbe8f82118cd1fc.js"
      integrity="sha256-u0h61gc3kMsCw1TujF&#43;IIsQsVRPhC/eoa76PghGM0fw="
      data-copy="Copy"
      data-copied="Copied"
    ></script>
  
  
  <meta
    name="description"
    content="
      
        
      
    "
  />
  
  
  
  <link rel="canonical" href="/internet/mysql/acid/" />
  
  
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  
  <meta property="og:url" content="/internet/mysql/acid/">
  <meta property="og:site_name" content="主页">
  <meta property="og:title" content="理解事务：InnoDB的ACID">
  <meta property="og:description" content="夭寿不贰，修身以俟">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="internet">
    <meta property="article:published_time" content="2022-01-16T17:05:00+08:00">
    <meta property="article:modified_time" content="2022-01-16T17:05:00+08:00">

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="理解事务：InnoDB的ACID">
  <meta name="twitter:description" content="夭寿不贰，修身以俟">

  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "",
    "name": "理解事务：InnoDB的ACID",
    "headline": "理解事务：InnoDB的ACID",
    
    
    "inLanguage": "en",
    "url" : "\/internet\/mysql\/acid\/",
    "author" : {
      "@type": "Person",
      "name": "stong"
    },
    "copyrightYear": "2022",
    "dateCreated": "2022-01-16T17:05:00\u002b08:00",
    "datePublished": "2022-01-16T17:05:00\u002b08:00",
    
    "dateModified": "2022-01-16T17:05:00\u002b08:00",
    
    
    
    "mainEntityOfPage": "true",
    "wordCount": "7551"
  }
  </script>


  
  <meta name="author" content="stong" />
  
    
      <link href="st5983@outlook.com" rel="me" />
    
      <link href="https://stong1994.github.io/" rel="me" />
    
      <link href="https://github.com/stong1994" rel="me" />
    
  
  
  






  
  
  
  
  
  




  
  
</head>
<body
    class="m-auto flex h-screen max-w-7xl flex-col bg-neutral px-6 text-lg leading-7 text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral"
  >
    <div id="the-top" class="absolute flex self-center">
      <a
        class="-translate-y-8 rounded-b-lg bg-primary-200 px-3 py-1 text-sm focus:translate-y-0 dark:bg-neutral-600"
        href="#main-content"
        ><span class="pe-2 font-bold text-primary-600 dark:text-primary-400">&darr;</span
        >Skip to main content</a
      >
    </div>
    
    
      <header class="py-6 font-semibold text-neutral-900 print:hidden sm:py-10 dark:text-neutral">
  <nav class="flex items-start justify-between sm:items-center">
    
    <div class="z-40 flex flex-row items-center">
      
  <a
    class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
    rel="me"
    href="/"
    >主页</a
  >

    </div>
    
      
      <label id="menu-button" for="menu-controller" class="block sm:hidden">
        <input type="checkbox" id="menu-controller" class="hidden" />
        <div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400">
          <span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>
</span>
        </div>
        <div
          id="menu-wrapper"
          class="invisible fixed inset-0 z-30 m-auto h-full w-full cursor-default overflow-auto bg-neutral-100/50 opacity-0 backdrop-blur-sm transition-opacity dark:bg-neutral-900/50"
        >
          <ul
            class="mx-auto flex w-full max-w-7xl list-none flex-col overflow-visible px-6 py-6 text-end sm:px-14 sm:py-10 sm:pt-10 md:px-24 lg:px-32"
          >
            <li class="mb-1">
              <span class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"
                ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>
</span></span
              >
            </li>
            
              
                
                <li class="group mb-1">
                  
                    <a
                      href="/internet/"
                      title=""
                      onclick="close_menu()"
                      
                      ><span
                          class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                          >计算机与互联网</span
                        >
                      </a
                    >
                  
                </li>
              
                
                <li class="group mb-1">
                  
                    <a
                      href="/cloudnative/"
                      title=""
                      onclick="close_menu()"
                      
                      ><span
                          class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                          >云原生</span
                        >
                      </a
                    >
                  
                </li>
              
                
                <li class="group mb-1">
                  
                    <a
                      href="/web3/"
                      title=""
                      onclick="close_menu()"
                      
                      ><span
                          class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                          >区块链&amp;web3</span
                        >
                      </a
                    >
                  
                </li>
              
                
                <li class="group mb-1">
                  
                    <a
                      href="/book/"
                      title=""
                      onclick="close_menu()"
                      
                      ><span
                          class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                          >读书笔记</span
                        >
                      </a
                    >
                  
                </li>
              
                
                <li class="group mb-1">
                  
                    <a
                      href="/other/"
                      title=""
                      onclick="close_menu()"
                      
                      ><span
                          class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                          >杂谈</span
                        >
                      </a
                    >
                  
                </li>
              
                
                <li class="group mb-1">
                  
                    <a
                      href="/slip_paper/"
                      title=""
                      onclick="close_menu()"
                      
                      ><span
                          class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                          >小碎片</span
                        >
                      </a
                    >
                  
                </li>
              
                
                <li class="group mb-1">
                  
                    <a
                      href="/mental_model/"
                      title=""
                      onclick="close_menu()"
                      
                      ><span
                          class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                          >心智模型</span
                        >
                      </a
                    >
                  
                </li>
              
                
                <li class="group mb-1">
                  
                    <a
                      href="/about/"
                      title=""
                      onclick="close_menu()"
                      
                      ><span
                          class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                          >关于</span
                        >
                      </a
                    >
                  
                </li>
              
                
                <li class="group mb-1">
                  
                    <a
                      href="https://github.com/stong1994/"
                      title=""
                      onclick="close_menu()"
                      target="_blank"
                      >
                        <span
                          class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"
                        ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span></a
                    >
                  
                </li>
              
                
                <li class="group mb-1">
                  
                    
                    
                      <button
                        id="search-button-1"
                        title="Search (/)"
                      >
                        
                          <span
                            class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"
                          ><span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></span><span
                            class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                            ></span
                          >
                        
                      </button>
                    
                  
                </li>
              
              
            
          </ul>
        </div>
      </label>
      
      <ul class="hidden list-none flex-row text-end sm:flex">
        
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0">
              
                <a
                  href="/internet/"
                  title=""
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >计算机与互联网</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0">
              
                <a
                  href="/cloudnative/"
                  title=""
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >云原生</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0">
              
                <a
                  href="/web3/"
                  title=""
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >区块链&amp;web3</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0">
              
                <a
                  href="/book/"
                  title=""
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >读书笔记</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0">
              
                <a
                  href="/other/"
                  title=""
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >杂谈</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0">
              
                <a
                  href="/slip_paper/"
                  title=""
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >小碎片</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0">
              
                <a
                  href="/mental_model/"
                  title=""
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >心智模型</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0">
              
                <a
                  href="/about/"
                  title=""
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >关于</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0">
              
                <a
                  href="https://github.com/stong1994/"
                  title=""
                  target="_blank"
                  >
                    <span
                      class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"
                    ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span></a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0">
              
                
                
                  <button
                    id="search-button-2"
                    title="Search (/)"
                  >
                    
                      <span
                        class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"
                      ><span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></span><span
                        class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                        ></span
                      >
                    
                  </button>
                
              
            </li>
          
          

        
      </ul>
    
  </nav>
</header>

    
    <div class="relative flex grow flex-col">
      <main id="main-content" class="grow">
        
  <article>
    <header class="max-w-prose">
      
        <ol class="text-sm text-neutral-500 print:hidden dark:text-neutral-400">
  
  
    
  
    
  
  <li class="hidden inline">
    <a
      class="dark:underline-neutral-600 decoration-neutral-300 hover:underline"
      href="/"
      >记录个人的成长记录</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class=" inline">
    <a
      class="dark:underline-neutral-600 decoration-neutral-300 hover:underline"
      href="/internet/"
      >internet</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="hidden inline">
    <a
      class="dark:underline-neutral-600 decoration-neutral-300 hover:underline"
      href="/internet/mysql/acid/"
      >理解事务：InnoDB的ACID</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

</ol>


      
      <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        理解事务：InnoDB的ACID
      </h1>
      
        <div class="mb-12 mt-8 text-base text-neutral-500 print:hidden dark:text-neutral-400">
          





  
  



  

  
  
    
  

  

  
    
  

  
    
  

  
    
  


  <div class="flex flex-row flex-wrap items-center">
    
    
      <time datetime="2022-01-16 17:05:00 &#43;0800 CST">16 January 2022</time><span class="px-2 text-primary-500">&middot;</span><span>7551 words</span><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">16 mins</span><span class="px-2 text-primary-500">&middot;</span>


  
  

<span class="mb-[2px]">
  <a
    href="https://github.com/stong1994/cristo/content/internet/storage/%e7%90%86%e8%a7%a3%e4%ba%8b%e5%8a%a1%ef%bc%9aInnoDB%e7%9a%84ACID.md"
    class="text-lg hover:text-primary-500"
    rel="noopener noreferrer"
    target="_blank"
    title="Edit content"
    ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M490.3 40.4C512.2 62.27 512.2 97.73 490.3 119.6L460.3 149.7L362.3 51.72L392.4 21.66C414.3-.2135 449.7-.2135 471.6 21.66L490.3 40.4zM172.4 241.7L339.7 74.34L437.7 172.3L270.3 339.6C264.2 345.8 256.7 350.4 248.4 353.2L159.6 382.8C150.1 385.6 141.5 383.4 135 376.1C128.6 370.5 126.4 361 129.2 352.4L158.8 263.6C161.6 255.3 166.2 247.8 172.4 241.7V241.7zM192 63.1C209.7 63.1 224 78.33 224 95.1C224 113.7 209.7 127.1 192 127.1H96C78.33 127.1 64 142.3 64 159.1V416C64 433.7 78.33 448 96 448H352C369.7 448 384 433.7 384 416V319.1C384 302.3 398.3 287.1 416 287.1C433.7 287.1 448 302.3 448 319.1V416C448 469 405 512 352 512H96C42.98 512 0 469 0 416V159.1C0 106.1 42.98 63.1 96 63.1H192z"/></svg>
</span></a
  >
</span>
    

    
    
  </div>

  
  
    <div class="my-1 flex flex-wrap text-xs leading-relaxed text-neutral-500 dark:text-neutral-400">
      
        
      
        
      
    </div>
  


        </div>
      
      
    </header>
    <section class="prose mt-0 flex max-w-full flex-col dark:prose-invert lg:flex-row">
      
        <div class="order-first px-0 lg:order-last lg:max-w-xs lg:ps-8">
          <div class="toc pe-5 print:hidden lg:sticky lg:top-10">
            <details open class="-ms-5 mt-0 overflow-hidden rounded-lg ps-5">
  <summary
    class="block cursor-pointer bg-neutral-100 py-1 ps-5 text-lg font-semibold text-neutral-800 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden"
  >
    Table of Contents
  </summary>
  <div class="border-s border-dotted border-neutral-300 py-2 ps-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#事务id的生成">事务id的生成</a></li>
        <li><a href="#原子性atomicity">原子性（Atomicity）</a>
          <ul>
            <li><a href="#undo-log">undo log</a></li>
            <li><a href="#对于插入操作">对于插入操作</a></li>
            <li><a href="#对于删除操作">对于删除操作</a></li>
            <li><a href="#对于更新操作">对于更新操作</a>
              <ul>
                <li><a href="#不更新主键">不更新主键</a></li>
                <li><a href="#更新主键">更新主键</a></li>
              </ul>
            </li>
            <li><a href="#undo-log在崩溃恢复时的作用">undo log在崩溃恢复时的作用</a></li>
          </ul>
        </li>
        <li><a href="#一致性consistency">一致性（Consistency）</a></li>
        <li><a href="#隔离性isolation">隔离性（Isolation）</a>
          <ul>
            <li><a href="#业内的隔离性划分非innodb">业内的隔离性划分（非InnoDB）</a>
              <ul>
                <li><a href="#四种隔离问题">四种隔离问题</a></li>
                <li><a href="#四种隔离级别">四种隔离级别</a></li>
                <li><a href="#三种锁">三种锁</a></li>
                <li><a href="#他们之间的关系">他们之间的关系</a></li>
              </ul>
            </li>
            <li><a href="#innodb实现">InnoDB实现</a>
              <ul>
                <li><a href="#record-lock">Record Lock</a></li>
                <li><a href="#gap-lock">Gap Lock</a></li>
                <li><a href="#next-key-lock">Next-Key Lock</a></li>
                <li><a href="#insert-intention-lock">Insert Intention Lock</a></li>
                <li><a href="#隐式锁">隐式锁</a></li>
                <li><a href="#自增锁">自增锁</a></li>
                <li><a href="#多版本并发控制mvcc">多版本并发控制（MVCC）</a>
                  <ul>
                    <li><a href="#readview">ReadView</a></li>
                    <li><a href="#判断某条记录是否可见">判断某条记录是否可见</a></li>
                    <li><a href="#读已提交与可重复读的区别">读已提交与可重复读的区别</a></li>
                    <li><a href="#二级索引">二级索引</a></li>
                    <li><a href="#purge">purge</a></li>
                    <li><a href="#mvcc产生幻读的特殊情况">MVCC产生幻读的特殊情况</a></li>
                  </ul>
                </li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#持久性durability">持久性（Durability）</a>
          <ul>
            <li><a href="#redo-log">redo log</a></li>
            <li><a href="#mtr">MTR</a></li>
            <li><a href="#log-buffer">log buffer</a></li>
            <li><a href="#刷盘时机">刷盘时机</a></li>
            <li><a href="#log-sequence-number">log sequence number</a></li>
            <li><a href="#checkpoint步骤">checkpoint步骤</a></li>
            <li><a href="#redo-log的写入方式">redo log的写入方式</a></li>
            <li><a href="#崩溃恢复">崩溃恢复</a>
              <ul>
                <li><a href="#加快恢复">加快恢复</a></li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</details>

          </div>
        </div>
      
      <div class="min-h-0 min-w-0 max-w-prose grow">
        <p>事务对于数据库而言是非常重要的，事务能够保证我们的软件世界是稳定的——从一个状态到另外一个状态是符合人们预期的。而为了能够保证一个事件在任何情况下都能符合人们的预期，我们总结出事务需要满足四个特性：原子性、一致性、隔离性、持久性。</p>
<p>每种数据库对于事务的实现都不同，有的数据库，如Redis，没有实现所有的事务特性，而目前比较火的分布式数据库，也有自己的实现特性——BASE。但理解事务的特性仍是软件开发行业从业者的基础素质。</p>
<p>本篇会以InnoDB为例，来探究它是如何实现事务的。</p>
<h2 id="事务id的生成" class="relative group">事务id的生成 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e4%ba%8b%e5%8a%a1id%e7%9a%84%e7%94%9f%e6%88%90" aria-label="Anchor">#</a></span></h2><p>事务id的生成规则与row_id的生成规则不能说相似，只能说一模一样。</p>
<ol>
<li>服务器在内存中维护一个全局变量，每当需要为某个事务分配事务id时，获取这个变量作为row_id的值，并把这个全局变量自增1</li>
<li>每当全局变量的值变为256的倍数时，就会将该变量写入系统表空间中</li>
<li>当系统启动时，将系统表空间中的该变量加上256加载到内存中（加256是为了确保内存中的值一定比记录中已存在的事务id值大）</li>
</ol>
<h2 id="原子性atomicity" class="relative group">原子性（Atomicity） <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e5%8e%9f%e5%ad%90%e6%80%a7atomicity" aria-label="Anchor">#</a></span></h2><blockquote>
<p>一个事务内的执行语句要么全执行，要么都不执行。可以理解为一个事务内的多个事件，如果有一个事件发生异常，就要回退到第一个事件发生前的状态。</p>
</blockquote>
<p>原子性要求我们可以对执行事务过程中改变的数据进行回滚，而为了实现回滚，InnoDB使用了undo log。</p>
<h3 id="undo-log" class="relative group">undo log <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#undo-log" aria-label="Anchor">#</a></span></h3><p>一个索引除了会产生叶子结点段和非叶子结点段之外，还会产生回滚段。我们的undo log就是存放在回滚段中。</p>
<p>对于每条记录，都会存在两个隐藏列：trx_id和roll_pointer。每次新增undo log时，会在新纪录上更新roll_pointer，指向新的undo log，而undo log也会记录旧记录上的roll_pointer，这样，以新纪录开始，与仍存在的旧记录形成了一条版本链。undo log上的旧记录可能不会记录所有的数据，如更新操作产生的日志就是只记录被更新的字段，但是通过遍历版本链就能找到旧记录的所有字段。</p>
<p>向表中插入/更新/删除一条记录时，需要对聚簇索引和所有二级索引都进行插入/更新/删除，但是在记录undo log时，我们只需要针对聚簇索引来记录。聚簇索引和二级索引都是一一对应的，在回滚时，根据主键信息对所有的二级索引都进行回滚即可。所以，只有聚簇索引才会存在回滚段。</p>
<h3 id="对于插入操作" class="relative group">对于插入操作 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e5%af%b9%e4%ba%8e%e6%8f%92%e5%85%a5%e6%93%8d%e4%bd%9c" aria-label="Anchor">#</a></span></h3><p>插入操作的回滚操作就是删除操作，因此，在undo log中记录插入记录的主键即可。</p>
<h3 id="对于删除操作" class="relative group">对于删除操作 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e5%af%b9%e4%ba%8e%e5%88%a0%e9%99%a4%e6%93%8d%e4%bd%9c" aria-label="Anchor">#</a></span></h3><p>删除操作的逆操作插入操作，按道理来说，undo log中会记录被删除的数据，但是InnoDB没有这样做。因为如果数据被删了，那么“其他人”就看不到了，先于这个事务执行的事务就可能会产生不可重复读或者幻读。</p>
<p>InnoDB中的实现是这样：</p>
<ol>
<li>第一阶段，将这个记录的deleted_flag（每个记录都有的隐藏列）标识为1，这就意味着这条记录正在删除中。同时，在undo log中需要记录索引各列的信息，用于后续的purge操作。</li>
<li>第二阶段，在事务提交后，会有专门的线程来把这条记录删除掉——把这条记录从正常记录链表中删除，并加入到垃圾链表中</li>
</ol>
<h3 id="对于更新操作" class="relative group">对于更新操作 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e5%af%b9%e4%ba%8e%e6%9b%b4%e6%96%b0%e6%93%8d%e4%bd%9c" aria-label="Anchor">#</a></span></h3><p>更新操作需要分为两种情况：更新主键、不更新主键</p>
<h4 id="不更新主键" class="relative group">不更新主键 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e4%b8%8d%e6%9b%b4%e6%96%b0%e4%b8%bb%e9%94%ae" aria-label="Anchor">#</a></span></h4><p>如果不更新主键，并且更新前后这条记录的各个字段占用的空间都不变，那么直接将变更的旧字段写到undo log即可。</p>
<p>如果更新后字段占用的空间有变化，那么就要删除这条旧记录，并将其放入“垃圾链表”中（并不是标记删除），如果新记录占用的空间小于旧记录，则可以“复用”旧记录的空间，否则需要重新申请一块空间来存放新记录。</p>
<p>undo log会记录更新的列的旧数据，以供回滚。</p>
<h4 id="更新主键" class="relative group">更新主键 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e6%9b%b4%e6%96%b0%e4%b8%bb%e9%94%ae" aria-label="Anchor">#</a></span></h4><p>如果要更新主键，那么就相当于先进行删除操作，再进行插入操作。即先对旧记录进行标记删除，再插入新数据，同时产生两条undo log。</p>
<h3 id="undo-log在崩溃恢复时的作用" class="relative group">undo log在崩溃恢复时的作用 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#undo-log%e5%9c%a8%e5%b4%a9%e6%ba%83%e6%81%a2%e5%a4%8d%e6%97%b6%e7%9a%84%e4%bd%9c%e7%94%a8" aria-label="Anchor">#</a></span></h3><p>服务器在崩溃后的恢复过程中，首先根据redo log将各个页面的数据恢复到之前的状态，但是有些没有提交的redo log可能已经被刷盘，因此未提交的事务修改过的页面也被恢复了。这时需要把这些页面回滚掉。</p>
<p>通过系统表空间定位到回滚段的位置，并找到状态为TRX_UNDO_ACTIVE的undo log链表，这意味着存在活跃的事务正在向这个undo log链表写入undo log，找到对应的事务id，并将其做出的修改全部回滚掉。</p>
<h2 id="一致性consistency" class="relative group">一致性（Consistency） <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e4%b8%80%e8%87%b4%e6%80%a7consistency" aria-label="Anchor">#</a></span></h2><p>关于一致性，似乎没有统一的说法，有的说ACID中的C是用来凑数的，一致性是事务要达到的目的，而不是事务特性；有的说一致性就是数据库对于数据的约束，如非空、唯一等；有的说一致性要由业务逻辑的程序来维持。不用纠结这些。</p>
<p>另外，区别于分布式数据库中的最终一致性，InnoDB中的一致性指的是强一致性。</p>
<h2 id="隔离性isolation" class="relative group">隔离性（Isolation） <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e9%9a%94%e7%a6%bb%e6%80%a7isolation" aria-label="Anchor">#</a></span></h2><blockquote>
<p>事务之间应该是隔离的、互不影响的。</p>
</blockquote>
<h3 id="业内的隔离性划分非innodb" class="relative group">业内的隔离性划分（非InnoDB） <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e4%b8%9a%e5%86%85%e7%9a%84%e9%9a%94%e7%a6%bb%e6%80%a7%e5%88%92%e5%88%86%e9%9d%9einnodb" aria-label="Anchor">#</a></span></h3><h4 id="四种隔离问题" class="relative group">四种隔离问题 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e5%9b%9b%e7%a7%8d%e9%9a%94%e7%a6%bb%e9%97%ae%e9%a2%98" aria-label="Anchor">#</a></span></h4><ul>
<li>脏写：一个事务修改了另一个未提交的事务的数据</li>
<li>脏读：一个事务读取了另一个未提交的事务修改后的数据</li>
<li>不可重复读：一个事务两次读取同一条记录的数据不同，因为被另一个事务修改</li>
<li>幻读：一个事务两次读取的范围数据不同，因为被另一个事务进行了插入/更新操作</li>
</ul>
<h4 id="四种隔离级别" class="relative group">四种隔离级别 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e5%9b%9b%e7%a7%8d%e9%9a%94%e7%a6%bb%e7%ba%a7%e5%88%ab" aria-label="Anchor">#</a></span></h4><ul>
<li>读未提交：只解决脏写问题</li>
<li>读已提交：解决脏写、脏读问题</li>
<li>可重复读：解决脏写、脏读、不可重复度问题</li>
<li>串行化：解决全部四个问题</li>
</ul>
<h4 id="三种锁" class="relative group">三种锁 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e4%b8%89%e7%a7%8d%e9%94%81" aria-label="Anchor">#</a></span></h4><ul>
<li>排它锁：对于同一条记录，只有一个事务能够修改</li>
<li>共享锁：对于同一条记录，多个事务都能读取，但不允许修改</li>
<li>范围锁：一个范围内的记录的共享锁</li>
</ul>
<h4 id="他们之间的关系" class="relative group">他们之间的关系 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e4%bb%96%e4%bb%ac%e4%b9%8b%e9%97%b4%e7%9a%84%e5%85%b3%e7%b3%bb" aria-label="Anchor">#</a></span></h4><table>
<thead>
<tr>
<th>使用的锁</th>
<th>隔离问题</th>
<th>隔离级别</th>
</tr>
</thead>
<tbody>
<tr>
<td>不用锁</td>
<td>未解决：脏写、脏读、不可重复度、幻读</td>
<td>无，脏写问题是必须要避免的</td>
</tr>
<tr>
<td>排它锁</td>
<td>只解决脏写</td>
<td>读未提交</td>
</tr>
<tr>
<td>排它锁+（读完就释放的）共享锁</td>
<td>解决脏写、脏读</td>
<td>读已提交</td>
</tr>
<tr>
<td>排它锁+（事务执行完才释放的）共享锁</td>
<td>解决脏写、脏读、不可重复读</td>
<td>可重复读</td>
</tr>
<tr>
<td>排它锁+共享锁+范围锁</td>
<td>解决脏写、脏读、不可重复读、幻读</td>
<td>串行化</td>
</tr>
</tbody>
</table>
<p>由上可以看出，是<strong>由于使用的锁不同，进而产生了隔离问题、隔离级别！</strong></p>
<h3 id="innodb实现" class="relative group">InnoDB实现 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#innodb%e5%ae%9e%e7%8e%b0" aria-label="Anchor">#</a></span></h3><p>不同于只支持表级锁的MyISAM，InnoDB支持行级锁。我们将共享锁记为S锁，排它锁记为X锁（在InnoDB中共享锁和排它锁可以视为修饰符，即排它型XX锁或共享型XX锁）。</p>
<p>除此之外，还有几种范围锁。</p>
<h4 id="record-lock" class="relative group">Record Lock <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#record-lock" aria-label="Anchor">#</a></span></h4><p>行级锁。分为排它型行级锁和共享型行级锁。</p>
<h4 id="gap-lock" class="relative group">Gap Lock <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#gap-lock" aria-label="Anchor">#</a></span></h4><p>为了<strong>防止插入幻影记录而存在的锁</strong>。</p>
<p>假设记录中存在主键为1, 5, 10, 20这四条记录了，如果对主键为10的记录加Gap Lock，那么主键范围在（5,10）的“虚拟”记录会被锁住。这时插入主键为6的记录会被阻塞。</p>
<h4 id="next-key-lock" class="relative group">Next-Key Lock <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#next-key-lock" aria-label="Anchor">#</a></span></h4><p>Record Lock 与Gap Lock的合体。</p>
<h4 id="insert-intention-lock" class="relative group">Insert Intention Lock <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#insert-intention-lock" aria-label="Anchor">#</a></span></h4><p>插入意向锁。事务在插入记录时，判断插入位置是否被其他事务加了gap锁，如果有，就进行等待，并在内存中生成一个插入意向锁，当gap锁被释放时，就可以获取到插入意向锁。多个插入意向锁不互斥，即多个事务可以同时获取一条记录的插入意向锁。插入意向锁也不会阻止其他事务获取该记录上任何类型的锁。</p>
<h4 id="隐式锁" class="relative group">隐式锁 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e9%9a%90%e5%bc%8f%e9%94%81" aria-label="Anchor">#</a></span></h4><p>当一个事务先插入一条记录，另外一个事务进行了<code>SELECT ... LOCK IN SHARE MODE</code>或者<code>SELECT ... FOR UPDATE</code>或者直接进行修改，此时这条记录上并没有任何锁，如果被第二个事务读取到或者修改，就会造成脏写、脏读问题。</p>
<p>这时第二个事务察觉到这条记录的trx_id是活跃的事务ID，不能对其进行读取或修改，因此需要帮忙对其生成一个锁结构，然后再自己生成一个锁结构，进入等待状态。</p>
<p>隐式锁起到了<strong>延迟生成锁结构</strong>的作用。</p>
<p>对于二级索引的记录，本身没有trx_id，但是可以通过页面的PageHeader部分找到PAGE_MAX_TRX_ID属性，如果这个属性的值小于当前事务的事务id，那么说明该页面的事务都已提交，否则需要回表通过聚簇索引找到trx_id。</p>
<h4 id="自增锁" class="relative group">自增锁 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e8%87%aa%e5%a2%9e%e9%94%81" aria-label="Anchor">#</a></span></h4><p>如果一个列设置了自增属性，那么有两种方式实现自增：</p>
<ol>
<li>采用AUTO-INCR锁，这是一个表级别的锁，每次获取插入数据的自增列的值时，需要先获取锁，语句执行后再释放。</li>
<li>采用轻量级锁，在生成需要的自增列额值后就释放，而不需要等待语句结束。</li>
</ol>
<h4 id="多版本并发控制mvcc" class="relative group">多版本并发控制（MVCC） <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e5%a4%9a%e7%89%88%e6%9c%ac%e5%b9%b6%e5%8f%91%e6%8e%a7%e5%88%b6mvcc" aria-label="Anchor">#</a></span></h4><p>为了保证不会出现脏读问题，我们需要使用S锁。但是使用锁会造成性能下降。InnoDB中通过MVCC实现了<strong>一致性的非锁定读</strong>。</p>
<h5 id="readview" class="relative group">ReadView <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#readview" aria-label="Anchor">#</a></span></h5><p>在事务中读取时，会生成一个ReadView，这个ReadView保证了事务不会读取到未提交的记录。ReadView中的属性：</p>
<ul>
<li>m_ids: 生成ReadView时，当前系统中活跃的读写事务的事务id列表</li>
<li>min_trx: m_ids中的最小值</li>
<li>max_trx_id: 在生产ReadView时，系统应该分配给下一个事务的事务id值</li>
<li>creator_trx_id: 生成该ReadView的事务的事务id</li>
</ul>
<h5 id="判断某条记录是否可见" class="relative group">判断某条记录是否可见 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e5%88%a4%e6%96%ad%e6%9f%90%e6%9d%a1%e8%ae%b0%e5%bd%95%e6%98%af%e5%90%a6%e5%8f%af%e8%a7%81" aria-label="Anchor">#</a></span></h5><ol>
<li>如果creator_trx_id与被访问记录的trx_id相同，说明是该事务产生的数据，可以访问。（注意：<strong>只有进行修改操作时，才会生成事务id</strong>，也就是说，如果在一个事务进行修改操作之前读取，生成的creator_trx_id是0，因此此条条件永不成立）</li>
<li>如果trx_id小于min_trx，说明在生成ReadView时事务已提交，可以访问。</li>
<li>如果trx_id大于等于max_trx_id，说明被访问记录所在的事务晚于该事务，不可访问。</li>
<li>如果trx_id位于[min_trx,max_trx_id)中，则判断trx_id是否处在m_ids中，如果在，则不可访问，否则，可以访问。</li>
</ol>
<p>如果某条记录不可访问，则通过undo log的版本链找到旧版本的记录了，再判断该记录是否可见，如果能，就读取该记录，否则沿着版本链一直读取旧记录。如果没有找到可用的旧记录，则该记录为不可见，忽略即可。</p>
<h5 id="读已提交与可重复读的区别" class="relative group">读已提交与可重复读的区别 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e8%af%bb%e5%b7%b2%e6%8f%90%e4%ba%a4%e4%b8%8e%e5%8f%af%e9%87%8d%e5%a4%8d%e8%af%bb%e7%9a%84%e5%8c%ba%e5%88%ab" aria-label="Anchor">#</a></span></h5><p>MVCC只在读已提交与可重复读中使用，读未提交可以读到未提交的数据，因此不需要，串行化使用锁实现，也不需要。</p>
<p>在隔离级别是读已提交时，每次读取都会生成一个ReadView（直接copy全局的ReadView），因此第二次生成的ReadView中的m_ids、min_trx、max_trx_id与第一次可能不同，这导致第二次读取到的数据可能比第一次读取到的数据更“新”，这可能导致不可重复读和幻读。</p>
<p>在隔离级别是可重复读时，一个事务只生成一个ReadView，每次读取都复用，因此能够保证每次读取到的数据是相同的。</p>
<h5 id="二级索引" class="relative group">二级索引 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e4%ba%8c%e7%ba%a7%e7%b4%a2%e5%bc%95" aria-label="Anchor">#</a></span></h5><p>二级索引记录中没有trx_id和roll_pointer，因此与聚簇索引所用MVCC的方式不同。</p>
<ol>
<li>找到二级索引页面的最大事务ID（PAGE_MAX_TRX_ID），跟min_trx_id比较，如果小于min_trx_id，则说明该页面的数据可见，否则，进行回表查询</li>
<li>通过回表在聚簇索引中找到该主键的第一个可见版本, 再比较利用二级索引查询时的值是否相同，如果相同，则将该数据发送给客户端，如果不同，就跳过。</li>
</ol>
<h5 id="purge" class="relative group">purge <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#purge" aria-label="Anchor">#</a></span></h5><p>对于insert undo log，事务提交后就可以释放，而update undo log需要支持MVCC，因此不能立即删除。当事务提交后，会将这个事务中产生的update undo log插入到回滚段中的history链表中，</p>
<p>为了支持MVCC，删除操作只是对记录进行了标记，并没有真正的删除——加入垃圾链表。</p>
<p>这些空间都要被释放掉，而purge操作的目的就是释放掉update undo log以及被标记删除的记录。</p>
<p>我们只要确保生成ReadView时不再访问他们，那么他们就可以释放掉了。那如何确保生成ReadView时不再访问他们？只要他们的事务提交后就不会访问了，因为最新的数据可以被访问了。</p>
<ul>
<li>
<p>在事务提交时，会为这个事务生成一个事务no，用来表示事务提交的顺序，递增。</p>
</li>
<li>
<p>一个ReadView中除了以上几个属性，还包含一个事务no，这个事务no是在ReadView生成时将系统中最大的事务no+1的值。</p>
</li>
<li>
<p>系统中所有的ReadView会按照创建时间连成一个链表，当执行purge操作时，会找到最早的ReadView，假定这个ReadView的事务no为100，然后从各个回滚段中的history链表中找到事务no小于100的undo log，将其删除，如果undo log的类型为删除类型，那么还要将其对应标记删除的记录放到垃圾链表中。</p>
</li>
</ul>
<h5 id="mvcc产生幻读的特殊情况" class="relative group">MVCC产生幻读的特殊情况 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#mvcc%e4%ba%a7%e7%94%9f%e5%b9%bb%e8%af%bb%e7%9a%84%e7%89%b9%e6%ae%8a%e6%83%85%e5%86%b5" aria-label="Anchor">#</a></span></h5><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">autocommit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1001</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">此时在另一个终端执行</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">autocommit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="mi">1001</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;not exist&#39;</span><span class="p">);</span><span class="w"> </span><span class="k">COMMIT</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">update</span><span class="w"> </span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;EXIST&#39;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1001</span><span class="p">;</span><span class="w"> </span><span class="o">#</span><span class="w"> </span><span class="err">此时能够获取到</span><span class="n">id</span><span class="o">=</span><span class="mi">1001</span><span class="err">的记录的写锁，因此能够更新，并将其记录的</span><span class="n">trx_id更新为当前事务的id</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1001</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">COMMIT</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><ol>
<li>
<p>第一次SELECT查询返回</p>
<pre tabindex="0"><code>Empty set (0.00 sec)
</code></pre></li>
<li>
<p>第二次查询返回（如果没有对id=1001的记录更新，此时查询不到id=1001的记录）</p>
<pre tabindex="0"><code>+------+-------
| id   | name  
+------+-------
| 1001 | EXIST
</code></pre></li>
</ol>
<p>所以在执行事务时，做SELECT操作需要判断是否要<code>LOCK IN SHARE MODE</code>或者<code>FOR UPDATE</code>，前者加S锁，后者加X锁。两者都不允许其他事务进行更改，但前者允许其他事务进行共享读。</p>
<h6 id="扩展串行化隔离级别下如何避免幻读" class="relative group">扩展：串行化隔离级别下如何避免幻读？ <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e6%89%a9%e5%b1%95%e4%b8%b2%e8%a1%8c%e5%8c%96%e9%9a%94%e7%a6%bb%e7%ba%a7%e5%88%ab%e4%b8%8b%e5%a6%82%e4%bd%95%e9%81%bf%e5%85%8d%e5%b9%bb%e8%af%bb" aria-label="Anchor">#</a></span></h6><p>对于<code>autocommit = 0</code>时，普通的SELECT语句会转换为<code>SELECT ... LOCK IN SHARE MODE</code>。</p>
<p>对于<code>autocommit = 1</code>时，不需要对SELECT加锁，只是利用MVCC生成一个ReadView来读取记录。因为自动提交时，一个事务只包含一条语句，不可能出现不可重复读、幻读等问题。</p>
<h2 id="持久性durability" class="relative group">持久性（Durability） <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e6%8c%81%e4%b9%85%e6%80%a7durability" aria-label="Anchor">#</a></span></h2><blockquote>
<p>事务一旦提交，那么数据就一定不会丢失（逻辑上不会丢失）</p>
</blockquote>
<p>在查询数据时，我们会把磁盘中的数据页加载到Buffer Pool中，在事务的执行过程中，也是对内存中的数据进行修改。在提交事务后，不会直接将Buffer Pool中的脏页进行刷盘，这样写入效率很低，这是因为：</p>
<ol>
<li>InnoDB是以页为单位进行磁盘IO，即使只改动了几个字节，也会对整个页进行刷盘</li>
<li>一个事务包括多条语句，每个语句有可能影响多个页，这些页可能不是挨着的，那么此时进行刷盘，会产生磁盘的随机IO</li>
</ol>
<h3 id="redo-log" class="relative group">redo log <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#redo-log" aria-label="Anchor">#</a></span></h3><p>但是，如果不进行刷盘，那么如果此时服务器崩溃，将导致内存中还未刷盘的数据丢失。因此，我们可以将Buffer Pool中的数据先存入一种日志中，这样做有这些好处：</p>
<ol>
<li>只将页面的改动内容存储到日志中，占用空间小</li>
<li>写入这种日志是磁盘的顺序IO，速度快</li>
</ol>
<p>这种日志我们称为重做日志，即redo log.</p>
<p>但是增删改操作并不仅仅只修改记录，还可能会修改聚簇索引和二级索引、数据页所在的Page Header、Page Directory等信息，如果这些信息都要记录的话，那么代价无疑是很大的，因此在InnoDB中，对每种操作都有特定的类型，只需要在redo log中记录关键信息，然后再调用对应的函数就能够进行“重做”。</p>
<h3 id="mtr" class="relative group">MTR <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#mtr" aria-label="Anchor">#</a></span></h3><p>一条语句可能产生多个redo log，对于这些redo log应该是“原子”的，我们把它放到一组，称为MTR。</p>
<h3 id="log-buffer" class="relative group">log buffer <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#log-buffer" aria-label="Anchor">#</a></span></h3><p>为了解决磁盘速度过慢的问题，在加载数据页时引入了Buffer Pool，同理，在redo log中引入了 redo log buffer——服务器在启动时就向操作系统申请了一大片内存空间，我们简称为log buffer。</p>
<h3 id="刷盘时机" class="relative group">刷盘时机 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e5%88%b7%e7%9b%98%e6%97%b6%e6%9c%ba" aria-label="Anchor">#</a></span></h3><p>redo log不能一直放在内存中，其刷盘时机为：</p>
<ol>
<li>log bufffer空间不足时</li>
<li>事务提交时。为了保证持久性，在事务提交时，必须刷盘。</li>
<li>在某个脏页刷新到磁盘前，会保证先将该脏页对应的redo log刷新到磁盘。</li>
<li>后台线程轮询进行刷盘</li>
<li>checkpoint时</li>
</ol>
<h3 id="log-sequence-number" class="relative group">log sequence number <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#log-sequence-number" aria-label="Anchor">#</a></span></h3><ol>
<li>lsn: 写到log buffer但还没有刷新到磁盘的redo log的数量</li>
<li>flushed_to_disk_lsn： 已刷新到磁盘的redo log的数量</li>
<li>checkpoint_lsn: 用来记录当前系统可以被覆盖的redo log的总量是多少。每次将一个脏页刷盘，并且对应的MTR能够被覆盖时，就对checkpoint_lsn加1.</li>
</ol>
<h3 id="checkpoint步骤" class="relative group">checkpoint步骤 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#checkpoint%e6%ad%a5%e9%aa%a4" aria-label="Anchor">#</a></span></h3><p>redo log的文件组的空间是有限的，因此我们需要循环使用这些文件，那么就需要知道哪些文件可以被覆盖。通过checkpoint我们可以得到checkpoint_lsn，这个值就是能够被覆盖的redo log的总量。</p>
<ol>
<li>
<p>计算当前系统中可以被覆盖的redo log对应的lsn值是多少</p>
<p>当我们说redo log可以被覆盖时，说明其对应的脏页都已经被刷新到了磁盘中。在flush链表中找到最早修改的脏页的oldest_modification值，那么系统中小于该节点的oldest_modification值时产生的redo log都可以被覆盖。我们把这个oldest_modification值赋给checkpoint_lsn（Buffer Pool中修改过的页的控制块被加入到了flush链表中，一个页可能被多个MTR进行修改，因此在控制块中保存着最新和最旧的MTR的lsn值）。</p>
</li>
<li>
<p>将checkpoint_lsn与对应的redo log文件组的偏移量以及此次checkpoint的编号写到日志文件的管理信息中。</p>
</li>
</ol>
<h3 id="redo-log的写入方式" class="relative group">redo log的写入方式 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#redo-log%e7%9a%84%e5%86%99%e5%85%a5%e6%96%b9%e5%bc%8f" aria-label="Anchor">#</a></span></h3><p>通过一个系统变量可以选择redo log的同步方式：</p>
<ul>
<li>0：事务提交时，不立即向磁盘同步redo log。如果服务器挂了，但是后台线程还没有将redo log刷盘，会造成数据丢失</li>
<li>1：事务提交时，需要将redo log同步到磁盘（默认选项）</li>
<li>2：事务提交时，将redo log写入到操作系统的缓冲区中，这样如果mysql服务挂了，但是服务器没挂，数据仍不会丢失。</li>
</ul>
<h3 id="崩溃恢复" class="relative group">崩溃恢复 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e5%b4%a9%e6%ba%83%e6%81%a2%e5%a4%8d" aria-label="Anchor">#</a></span></h3><p>checkpoint_lsn值记录了可以被覆盖的redo log的数量，也就是这些redo log对应的脏页已经刷盘，因此没必要对这些日志进行redo，对于lsn的值不小于checkpoint_lsn的redo log，它们对应的脏页可能被刷盘，也可能没被刷盘，因此对于这些redo log，我们需要redo。</p>
<p>checkpoint_lsn存在于每个redo log文件组的控制block中，对于每个redo log文件组中的block，没有记录checkpoint_lsn值，但是对于填满的block，其属性LOG_BLOCK_HDR_DATA_LEN值总是512，而只要找到该值小于512的block，这个block就是需要扫描的最后一个block。（这里并不确定扫描的block对应的事务已提交，因此可能会将未提交的事务的数据加载到磁盘中，需要通过undo log进行回滚）</p>
<h4 id="加快恢复" class="relative group">加快恢复 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e5%8a%a0%e5%bf%ab%e6%81%a2%e5%a4%8d" aria-label="Anchor">#</a></span></h4><p>可以通过把space id和page number相同的redo log放到一个哈希表的同一个槽中，这样能够对同一个页面的redo log一次性修复好，还能避免随机IO。</p>
<p>另外，每个页面在File Header中都有FIL_PAGE_LSN属性，记录了最近一次修改页面对应的lsn值，在通过redo log进行redo时，如果发现当前redo log的lsn值小于页面的FIL_PAGE_LSN值，就不需要进行redo。</p>

      </div>
    </section>
    <footer class="max-w-prose pt-8 print:hidden">
      
  <div class="flex">
    
    
    
      
      
        
        








  
    <picture
      class="!mb-0 !mt-0 me-4 w-24 h-auto rounded-full"
      
    >
      
      
      
      
      <img
        width="1080"
        height="1434"
        class="!mb-0 !mt-0 me-4 w-24 h-auto rounded-full"
        alt="stong"
        loading="lazy" decoding="async"
        
          src="/imgs/mine_hu9cc37546ab3d9fb1d864cca548ef6007_144068_660x0_resize_q75_box.jpg"
          srcset="/imgs/mine_hu9cc37546ab3d9fb1d864cca548ef6007_144068_330x0_resize_q75_box.jpg 330w,/imgs/mine_hu9cc37546ab3d9fb1d864cca548ef6007_144068_660x0_resize_q75_box.jpg 660w
          
            ,/imgs/mine_hu9cc37546ab3d9fb1d864cca548ef6007_144068_1024x0_resize_q75_box.jpg 1024w
          
          
            ,/imgs/mine.jpg 1080w
          "
          sizes="100vw"
        
      />
    </picture>
  


      
    
    <div class="place-self-center">
      
        <div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">
          Author
        </div>
        <div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">
          stong
        </div>
      
      
        <div class="text-sm text-neutral-700 dark:text-neutral-400">进击的程序员</div>
      
      <div class="text-2xl sm:text-lg">
  <div class="flex flex-wrap text-neutral-400 dark:text-neutral-500">
    
      
        <a
          class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400"
          style="will-change:transform;"
          href="st5983@outlook.com"
          target="_blank"
          aria-label="Email"
          rel="me noopener noreferrer"
          ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1c-27.64 140.9 68.65 266.2 199.1 285.1c19.01 2.888 36.17-12.26 36.17-31.49l.0001-.6631c0-15.74-11.44-28.88-26.84-31.24c-84.35-12.98-149.2-86.13-149.2-174.2c0-102.9 88.61-185.5 193.4-175.4c91.54 8.869 158.6 91.25 158.6 183.2l0 16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98 .0036c-7.299 0-13.2 4.992-15.12 11.68c-24.85-12.15-54.24-16.38-86.06-5.106c-38.75 13.73-68.12 48.91-73.72 89.64c-9.483 69.01 43.81 128 110.9 128c26.44 0 50.43-9.544 69.59-24.88c24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3C495.1 107.1 361.2-9.332 207.8 20.73zM239.1 304.3c-26.47 0-48-21.56-48-48.05s21.53-48.05 48-48.05s48 21.56 48 48.05S266.5 304.3 239.1 304.3z"/></svg>
</span></a
        >
      
    
      
        <a
          class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400"
          style="will-change:transform;"
          href="https://stong1994.github.io/"
          target="_blank"
          aria-label="Link"
          rel="me noopener noreferrer"
          ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M172.5 131.1C228.1 75.51 320.5 75.51 376.1 131.1C426.1 181.1 433.5 260.8 392.4 318.3L391.3 319.9C381 334.2 361 337.6 346.7 327.3C332.3 317 328.9 297 339.2 282.7L340.3 281.1C363.2 249 359.6 205.1 331.7 177.2C300.3 145.8 249.2 145.8 217.7 177.2L105.5 289.5C73.99 320.1 73.99 372 105.5 403.5C133.3 431.4 177.3 435 209.3 412.1L210.9 410.1C225.3 400.7 245.3 404 255.5 418.4C265.8 432.8 262.5 452.8 248.1 463.1L246.5 464.2C188.1 505.3 110.2 498.7 60.21 448.8C3.741 392.3 3.741 300.7 60.21 244.3L172.5 131.1zM467.5 380C411 436.5 319.5 436.5 263 380C213 330 206.5 251.2 247.6 193.7L248.7 192.1C258.1 177.8 278.1 174.4 293.3 184.7C307.7 194.1 311.1 214.1 300.8 229.3L299.7 230.9C276.8 262.1 280.4 306.9 308.3 334.8C339.7 366.2 390.8 366.2 422.3 334.8L534.5 222.5C566 191 566 139.1 534.5 108.5C506.7 80.63 462.7 76.99 430.7 99.9L429.1 101C414.7 111.3 394.7 107.1 384.5 93.58C374.2 79.2 377.5 59.21 391.9 48.94L393.5 47.82C451 6.731 529.8 13.25 579.8 63.24C636.3 119.7 636.3 211.3 579.8 267.7L467.5 380z"/></svg>
</span></a
        >
      
    
      
        <a
          class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400"
          style="will-change:transform;"
          href="https://github.com/stong1994"
          target="_blank"
          aria-label="Github"
          rel="me noopener noreferrer"
          ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></a
        >
      
    
  </div>

</div>
    </div>
  </div>


      

      
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
            <a class="group flex" href="/internet/MySQL/curd/">
              <span
                class="me-2 text-neutral-700 transition-transform group-hover:-translate-x-[2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"
                ><span class="ltr:inline rtl:hidden">&larr;</span
                ><span class="ltr:hidden rtl:inline">&rarr;</span></span
              >
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >查询、插入、删除、更新一条MySQL记录都经历了什么</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2022-01-06 17:05:00 &#43;0800 CST">6 January 2022</time>
                  
                </span>
              </span>
            </a>
          
        </span>
        <span>
          
            <a class="group flex text-right" href="/internet/algorithm/kmp/">
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >KMP算法</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2022-01-28 16:32:00 &#43;0800 CST">28 January 2022</time>
                  
                </span>
              </span>
              <span
                class="ms-2 text-neutral-700 transition-transform group-hover:-translate-x-[2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"
                ><span class="ltr:inline rtl:hidden">&rarr;</span
                ><span class="ltr:hidden rtl:inline">&larr;</span></span
              >
            </a>
          
        </span>
      </div>
    </div>
  


      
    </footer>
  </article>

        
          <div class="pointer-events-none absolute bottom-0 end-0 top-[100vh] w-12">
            <a
              href="#the-top"
              class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
              aria-label="Scroll to top"
              title="Scroll to top"
            >
              &uarr;
            </a>
          </div>
        
      </main><footer class="py-10 print:hidden">
  
  
  <div class="flex items-center justify-between">
    <div>
      
      
        <p class="text-sm text-neutral-500 dark:text-neutral-400">
            &copy;
            2024
            stong
        </p>
      
      
      
        <p class="text-xs text-neutral-500 dark:text-neutral-400">
          
          
          Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
            href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href="https://github.com/jpanther/congo" target="_blank" rel="noopener noreferrer">Congo</a>
        </p>
      
    </div>
    <div class="flex flex-row items-center">
      
      
      
      
        <div
          class="me-14 cursor-pointer text-sm text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        >
          <button id="appearance-switcher-0" type="button" aria-label="appearance switcher">
            <div
              class="flex h-12 w-12 items-center justify-center dark:hidden"
              title="Switch to dark appearance"
            >
              <span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>
</span>
            </div>
            <div
              class="hidden h-12 w-12 items-center justify-center dark:flex"
              title="Switch to light appearance"
            >
              <span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>
</span>
            </div>
          </button>
        </div>
      
    </div>
  </div>
  
  
</footer>
<div
  id="search-wrapper"
  class="invisible fixed inset-0 z-50 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm sm:p-6 md:p-[10vh] lg:p-[12vh] dark:bg-neutral-900/50"
  data-url="/"
>
  <div
    id="search-modal"
    class="top-20 mx-auto flex min-h-0 w-full max-w-3xl flex-col rounded-md border border-neutral-200 bg-neutral shadow-lg dark:border-neutral-700 dark:bg-neutral-800"
  >
    <header class="relative z-10 flex flex-none items-center justify-between px-2">
      <form class="flex min-w-0 flex-auto items-center">
        <div class="flex h-8 w-8 items-center justify-center text-neutral-400">
          <span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
        </div>
        <input
          type="search"
          id="search-query"
          class="mx-1 flex h-12 flex-auto appearance-none bg-transparent focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="Search"
          tabindex="0"
        />
      </form>
      <button
        id="close-search-button"
        class="flex h-8 w-8 items-center justify-center text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="Close (Esc)"
      >
        <span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>
</span>
      </button>
    </header>
    <section class="flex-auto overflow-auto px-2">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

    </div>
  </body>
</html>
